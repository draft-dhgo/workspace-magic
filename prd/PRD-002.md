# PRD-002: Compose — 워크스페이스 조합 시스템

> 한 줄 요약: 스킬·에이전트·커맨드·MCP 설정과 워크트리 레포를 하나의 조합(Compose)으로 묶어 관리하고, 지정 디렉토리에 한 번에 세팅하는 기능.

## 1. 배경 (Background)

### 문제 정의

- 현재 워크스페이스를 세팅할 때 워크트리 생성만 지원하며, Claude Code 설정(.claude/ 디렉토리, 스킬, 에이전트, MCP 설정 등)은 수동으로 구성해야 함
- 프로젝트마다 필요한 스킬/에이전트/MCP 조합이 다르고, 매번 수동으로 세팅하는 것은 비효율적
- 스킬/에이전트/커맨드/MCP 설정을 관리할 수 있는 GUI가 없어 텍스트 에디터로 직접 파일을 다뤄야 함

### 동기

- 워크트리 + Claude Code 환경을 하나의 단위로 관리하면 재현 가능한 워크스페이스를 즉시 구성할 수 있음
- GUI 기반 CRUD로 Claude Code 설정 요소의 접근성을 높임

## 2. 목표 (Goals)

### 핵심 목표

- [ ] 스킬, 에이전트, 커맨드, MCP 설정을 앱 내 GUI로 생성·조회·편집·삭제 가능
- [ ] 위 요소들과 워크트리 레포를 하나의 조합(Compose)으로 묶어 관리 가능
- [ ] 조합을 지정 디렉토리에 적용하면 .claude/ 구조 + worktree가 한 번에 생성됨
- [ ] 기존 PRD의 개별 레포 선택 방식을 조합 기반으로 대체

### 비목표 (Non-Goals)

- 원격 저장소에서 클론하는 기능 (로컬 레포만 지원)
- 조합 공유/내보내기/가져오기 (향후 고려)
- Claude Code 자체의 실행이나 대화 기능

## 3. 사용자 (Users)

### 타깃 사용자

- 여러 git 레포를 조합하여 프로젝트 워크스페이스를 구성하는 개발자
- Claude Code를 활용하며 프로젝트별로 다른 스킬/에이전트/MCP 설정이 필요한 사용자

### 사용자 시나리오

- **시나리오 1**: 사용자가 "백엔드 개발" 조합을 만든다. repo-api, repo-common을 워크트리로 포함하고, prd 스킬 + implement 에이전트 + DB 관련 MCP 설정을 추가한다. 새 프로젝트 시작 시 빈 폴더를 우클릭하고 이 조합을 선택하면 모든 세팅이 완료된다.
- **시나리오 2**: 사용자가 앱에서 새로운 스킬을 텍스트로 작성하여 등록한 뒤, 기존 조합에 추가한다.
- **시나리오 3**: 사용자가 기존에 있던 .claude/.skills/ 디렉토리의 스킬 파일을 앱에 등록하여 조합에서 관리한다.

## 4. 기능 요구사항 (Functional Requirements)

### 핵심 기능

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-1 | 리소스 레지스트리 | 스킬, 에이전트, 커맨드, MCP 설정, 소스 레포를 앱 내에서 등록·관리 | P0 |
| FR-2 | 리소스 GUI CRUD | 등록된 리소스를 GUI로 생성·조회·편집·삭제 | P0 |
| FR-3 | 조합(Compose) 관리 | 리소스들을 묶어 조합을 생성·편집·삭제 | P0 |
| FR-4 | 조합 적용 | 조합을 지정 디렉토리에 적용하여 .claude/ 구조 + worktree 생성 | P0 |
| FR-5 | 조합 선택 UI | 지정 디렉토리에 적용할 조합을 선택하는 화면 | P0 |

### 상세 플로우

#### 4-1. 리소스 레지스트리

앱 내에서 관리되는 리소스 유형:

| 리소스 유형 | Claude Code 경로 | 설명 |
|-------------|------------------|------|
| 스킬 (Skill) | `.claude/.skills/{name}/SKILL.md` + 하위 파일들 | Claude Code 스킬 정의 |
| 에이전트 (Agent) | `.claude/agents/{name}.md` | 커스텀 에이전트 정의 |
| 커맨드 (Command) | `.claude/commands/{name}.md` | 슬래시 커맨드 정의 |
| MCP 설정 | `.mcp.json` | MCP 서버 설정 |
| 소스 레포 | 로컬 git 저장소 경로 | worktree 생성 대상 |

#### 4-2. 리소스 등록 방식

**방식 A: 텍스트 입력으로 생성**
1. 리소스 유형 선택 (스킬 / 에이전트 / 커맨드 / MCP)
2. GUI 에디터에서 내용 작성
   - 스킬: SKILL.md frontmatter + 본문 작성, 하위 파일(references/, examples/ 등) 추가 가능
   - 에이전트: frontmatter + 시스템 프롬프트 작성
   - 커맨드: 커맨드 내용 작성
   - MCP: JSON 에디터로 MCP 서버 설정 작성
3. 앱 데이터에 저장

**방식 B: 기존 파일 등록**
1. 파일 탐색기로 로컬 파일/디렉토리 선택
2. 해당 파일 내용을 앱 데이터로 복사하여 등록
   - 스킬: 디렉토리 단위 등록 (SKILL.md + 하위 파일들)
   - 에이전트/커맨드: 단일 .md 파일 등록
   - MCP: .mcp.json 파일 등록
3. 유효성 검증 후 등록 완료

#### 4-3. 리소스 CRUD

- **생성 (Create)**: 4-2의 방식 A 또는 B
- **조회 (Read)**: 등록된 리소스 목록 표시, 개별 리소스 상세 내용 조회
- **편집 (Update)**: GUI 에디터에서 등록된 리소스 내용 직접 수정
- **삭제 (Delete)**: 레지스트리에서 리소스 제거 (확인 다이얼로그)

#### 4-4. 조합(Compose) 관리

조합은 다음 요소를 하나의 패키지로 묶음:

```
compose-a (조합)
├── 워크트리 레포 목록
│   ├── repo1 (+ 베이스 브랜치 설정)
│   └── repo2 (+ 베이스 브랜치 설정)
├── 스킬 목록
│   ├── skill-x
│   └── skill-y
├── 에이전트 목록
│   └── agent-a
├── 커맨드 목록
│   └── command-1
└── MCP 설정
    └── mcp-config
```

**조합 생성/편집 화면:**
1. 조합 이름 입력
2. 레지스트리에서 포함할 리소스를 체크박스로 선택
   - 소스 레포: 선택 시 베이스 브랜치 지정
   - 스킬/에이전트/커맨드/MCP: 선택만으로 포함
3. 저장

**조합 CRUD:**
- 생성: 새 조합 생성
- 조회: 조합 목록 및 상세 (포함된 리소스 표시)
- 편집: 포함 리소스 변경, 이름 변경
- 삭제: 조합 삭제 (확인 다이얼로그)

#### 4-5. 조합 적용 (워크스페이스 세팅)

조합을 지정 디렉토리에 적용하면 다음이 수행됨:

**Step 1: .claude/ 구조 생성**
```
{지정 디렉토리}/
├── .claude/
│   ├── settings.json          ← 스킬 등록 정보 포함
│   ├── .skills/
│   │   ├── {skill-x}/
│   │   │   ├── SKILL.md
│   │   │   └── references/...
│   │   └── {skill-y}/
│   │       └── SKILL.md
│   ├── agents/
│   │   └── {agent-a}.md
│   └── commands/
│       └── {command-1}.md
└── .mcp.json                  ← MCP 설정
```

- `settings.json`에 스킬 경로 자동 등록
- 스킬은 디렉토리 구조 포함 (SKILL.md + references/ + examples/ 등)
- 에이전트, 커맨드는 .md 파일 생성
- MCP 설정은 .mcp.json으로 생성

**Step 2: Worktree 생성**

조합에 포함된 각 레포에 대해:

1. 새 브랜치 이름 입력 (적용 시점에 사용자 입력)
2. `git worktree add {지정 디렉토리}/{레포 이름} -b {새 브랜치} {베이스 브랜치}` 실행
3. 소스 레포 디렉토리에서 명령 실행

**적용 결과 예시:**
```
{지정 디렉토리}/
├── .claude/                   ← Claude Code 설정
│   ├── settings.json
│   ├── .skills/
│   ├── agents/
│   └── commands/
├── .mcp.json                  ← MCP 설정
├── repo1/                     ← git worktree
└── repo2/                     ← git worktree
```

#### 4-6. 기존 워크트리 기능 대체

기존 PRD의 개별 레포 선택 → 브랜치 선택 → worktree 생성 플로우를 조합 기반으로 대체:

- **기존**: 레포 레지스트리에서 개별 레포 체크 → 각 레포별 브랜치 선택 → 실행
- **변경**: 조합 선택 → 새 브랜치 이름 입력 → 실행 (.claude/ 구조도 함께 생성)

### GUI 변경 사항

#### 메인 화면 구성

기존 PRD의 레이아웃을 다음과 같이 변경:

| 영역 | 기존 | 변경 |
|------|------|------|
| 상단 | 지정 디렉토리 경로 | 지정 디렉토리 경로 (유지) |
| 중앙 | 레포 레지스트리 체크리스트 | **조합 선택** 화면 |
| 하단 | 실행 버튼 + 상태 | 실행 버튼 + 상태 (유지) |

#### 추가 화면

| 화면 | 설명 |
|------|------|
| 리소스 관리 | 스킬/에이전트/커맨드/MCP/레포 CRUD |
| 조합 관리 | 조합 CRUD (리소스 선택 포함) |

### 진행 상태 표시

기존 PRD의 진행 상태 표시를 확장:

| 단계 | 상태 |
|------|------|
| .claude/ 구조 생성 | 대기 / 진행중 / 완료 / 에러 |
| 각 레포 worktree 생성 | 대기 / 진행중 / 완료 / 스킵 / 에러 |

### 중복/충돌 처리

기존 PRD의 처리 방식을 확장:

| 상황 | 처리 |
|------|------|
| 지정 디렉토리에 동일 이름 디렉토리 존재 (worktree) | 스킵 + 알림 |
| 지정 디렉토리에 .claude/ 이미 존재 | 사용자에게 덮어쓰기/병합/취소 선택 |
| 지정 디렉토리에 .mcp.json 이미 존재 | 사용자에게 덮어쓰기/병합/취소 선택 |

## 5. 비기능 요구사항 (Non-Functional Requirements)

- **성능**: 조합 적용 시 .claude/ 구조 생성은 1초 이내, worktree 생성은 레포당 비동기 실행
- **데이터 무결성**: 앱 데이터(리소스, 조합)는 JSON 파일로 `electron app.getPath('userData')` 하위에 저장
- **유효성**: 소스 레포 등록/적용 시 유효한 git 저장소인지 검증 (기존 PRD 유지)
- **Claude Code 호환**: 생성되는 .claude/ 구조와 .mcp.json은 Claude Code 공식 경로 체계를 정확히 따름

## 6. 엣지 케이스 & 예외 처리

| 상황 | 처리 방식 |
|------|-----------|
| 조합에 포함된 소스 레포가 삭제/이동됨 | 적용 시 해당 레포 스킵 + 경고 |
| 조합에 포함된 리소스가 삭제됨 | 조합 조회 시 누락 표시 + 경고 |
| .claude/ 구조 생성 중 권한 오류 | 에러 메시지 표시 + 중단 |
| 조합에 레포 없이 .claude/ 설정만 있는 경우 | .claude/ 구조만 생성 (유효) |
| 조합에 .claude/ 설정 없이 레포만 있는 경우 | worktree만 생성 (유효) |
| 동일 이름의 조합 생성 시도 | 중복 불가, 에러 메시지 |

## 7. 성공 지표 (Success Metrics)

- 조합 1개로 워크스페이스 전체(worktree + Claude Code 설정)를 세팅할 수 있는가
- 스킬/에이전트/커맨드/MCP를 CLI나 텍스트 에디터 없이 GUI만으로 관리할 수 있는가
- 생성된 .claude/ 구조가 Claude Code에서 정상 인식되는가

## 8. 타임라인 & 마일스톤

| 마일스톤 | 내용 | 비고 |
|----------|------|------|
| M1 | 리소스 레지스트리 + GUI CRUD | 스킬/에이전트/커맨드/MCP 관리 |
| M2 | 조합(Compose) 관리 | 조합 CRUD |
| M3 | 조합 적용 | 지정 디렉토리에 .claude/ + worktree 생성 |
| M4 | 기존 워크트리 기능 대체 | 메인 화면 조합 선택으로 변경 |

## 9. 열린 질문 (Open Questions)

- [ ] 조합에 포함된 MCP 설정이 여러 개일 때 병합 전략은?
- [ ] 스킬 하위 파일(references/, examples/)의 GUI 편집 UX는 어떻게 구성할 것인가?
- [ ] CLAUDE.md 파일도 조합에 포함할 필요가 있는가?

## 10. 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|-----------|--------|
| 2026-02-27 | 초안 작성 | Claude & godaehyeon |

## 부록: 기존 PRD 영향 분석

### 대체되는 기능

| 기존 PRD 섹션 | 상태 | 변경 내용 |
|---------------|------|-----------|
| 2-3. 레포 레지스트리 관리 | **이동** | 리소스 레지스트리로 통합 |
| 2-4. Worktree 생성 흐름 | **대체** | 조합 적용 플로우로 대체 |
| 2-5. 중복/충돌 처리 | **확장** | .claude/ 충돌 처리 추가 |
| 2-6. 진행 상태 표시 | **확장** | .claude/ 생성 상태 추가 |

### 유지되는 기능

| 기존 PRD 섹션 | 비고 |
|---------------|------|
| 1. OS 컨텍스트 메뉴 통합 | 그대로 유지 |
| 2-1. 레이아웃 (상단/하단) | 유지, 중앙만 변경 |
| 2-2. 지정 디렉토리 | 그대로 유지 |
| 3. 데이터 저장 | 확장 (리소스/조합 데이터 추가) |
| 4. 설치 및 배포 | 그대로 유지 |
