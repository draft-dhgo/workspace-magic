# PRD: Workspace Magic

## 개요

로컬 git 저장소들을 특정 디렉토리에 git worktree로 한번에 세팅할 수 있는 크로스플랫폼 데스크톱 앱.

OS 파일 탐색기에서 폴더를 우클릭하면 "Add Workspace" 메뉴가 나타나고, 클릭 시 GUI가 실행된다. GUI에서 사전 등록된 git 저장소들을 선택하여 해당 폴더(지정 디렉토리)에 worktree를 생성한다.

## 용어 정의

| 용어 | 설명 |
|------|------|
| 지정 디렉토리 | 우클릭하여 GUI를 띄운 대상 폴더. worktree가 생성될 위치 |
| 소스 레포 | 사용자가 사전 등록한 로컬 git 저장소 경로 |
| 레포 레지스트리 | 등록된 소스 레포 목록 (앱 설정에 영구 저장) |

## 대상 플랫폼

- Windows
- macOS

## 기술 스택

- Electron (데스크톱 앱)
- React + TypeScript (GUI)
- Node.js child_process (git 명령 실행)

---

## 기능 요구사항

### 1. OS 컨텍스트 메뉴 통합

#### 1-1. Windows

- 폴더 우클릭 시 컨텍스트 메뉴에 **"Add Workspace"** 항목 표시
- 클릭 시 Electron 앱 실행, 해당 폴더 경로를 인자로 전달
- 레지스트리 기반 구현 (인스톨러에서 등록)

#### 1-2. macOS

- Finder에서 폴더 우클릭 시 **Quick Actions**에 "Add Workspace" 표시
- Automator/Shell Script 기반으로 Electron 앱 실행, 폴더 경로를 인자로 전달
- 앱 설치 시 Quick Action 자동 설정

### 2. GUI

#### 2-1. 레이아웃

- 상단: **지정 디렉토리** 경로 표시
- 중앙: **레포 레지스트리** 목록 (체크박스로 선택)
- 하단: **실행 버튼** 및 상태 표시

#### 2-2. 지정 디렉토리

- 컨텍스트 메뉴에서 실행 시: 전달받은 경로를 자동 세팅
- 앱을 직접 실행한 경우: 파일 탐색기로 지정 디렉토리를 선택할 수 있게 함

#### 2-3. 레포 레지스트리 관리

- **추가**: 파일 탐색기 다이얼로그로 로컬 git 저장소 경로를 탐색하여 등록
- **목록 표시**: 등록된 레포 목록을 리스트로 표시
- **삭제**: 개별 레포를 목록에서 제거 가능
- **유효성 검증**:
  - 앱 시작 시 및 등록 시 해당 경로가 유효한 git 저장소인지 검증 (`git rev-parse --is-inside-work-tree`)
  - git 저장소가 아닌 항목은 경고 표시 후 **자동 삭제**

#### 2-4. Worktree 생성 흐름

1. 레포 레지스트리에서 worktree를 생성할 레포를 **체크박스로 선택**
2. 선택된 각 레포에 대해:
   - **베이스 브랜치 선택**: 해당 레포의 브랜치 목록(`git branch -a`) 표시, 사용자가 선택
   - **새 브랜치 이름 입력**: 워크트리에서 사용할 새 브랜치 이름 지정
3. **실행** 버튼 클릭 시:
   - `git worktree add <지정 디렉토리>/<레포 이름> -b <새 브랜치> <베이스 브랜치>` 실행
   - 소스 레포 디렉토리에서 위 명령 실행

#### 2-5. 중복/충돌 처리

- 지정 디렉토리 내에 **동일한 이름의 디렉토리가 이미 존재**하면 해당 레포는 **스킵**
- 스킵된 항목은 사용자에게 알림 (예: "already exists, skipped")

#### 2-6. 진행 상태 표시

- 각 레포별 worktree 생성 진행 상태 표시 (대기 / 진행중 / 완료 / 스킵 / 에러)
- git 명령 에러 발생 시 에러 메시지 표시

### 3. 데이터 저장

- **저장 위치**: `electron app.getPath('userData')` 하위 JSON 파일
- **저장 내용**:
  - 등록된 소스 레포 경로 목록

### 4. 설치 및 배포

#### 4-1. Windows

- NSIS 인스톨러
- 설치 시 레지스트리에 컨텍스트 메뉴 항목 등록
- 제거 시 레지스트리 정리

#### 4-2. macOS

- DMG 패키지
- 설치 후 Finder Quick Action 자동 설정
- 제거 시 Quick Action 정리

---

## 비기능 요구사항

- git 명령은 비동기로 실행, UI 블로킹 없어야 함
- 등록된 레포가 많아도 목록 스크롤이 매끄러워야 함
- git이 시스템에 설치되어 있어야 함 (미설치 시 안내 메시지 표시)

---

## 향후 고려 사항 (Scope 외)

- 생성된 worktree 관리 (삭제, 목록 조회)
- 레포 그룹 프리셋 (자주 쓰는 레포 조합 저장)
- CLI 모드 지원
