# PRD (통합): Workspace Magic

> 한 줄 요약: 로컬 git 레포와 Claude Code 설정(스킬·에이전트·커맨드·MCP)을 조합(Compose)으로 묶어 관리하고, 지정 디렉토리에 워크스페이스를 한 번에 세팅하는 크로스플랫폼 데스크톱 앱.

**통합 출처**: PRD-001 (기본 워크트리 세팅), PRD-002 (Compose 조합 시스템)

---

## 용어 정의

| 용어 | 설명 |
|------|------|
| 지정 디렉토리 | 우클릭하여 GUI를 띄운 대상 폴더. worktree 및 .claude/ 구조가 생성될 위치 |
| 소스 레포 | 사용자가 사전 등록한 로컬 git 저장소 경로 |
| 리소스 | 앱에서 관리하는 단위 요소 (소스 레포, 스킬, 에이전트, 커맨드, MCP 설정) |
| 리소스 레지스트리 | 등록된 리소스 목록 (앱 설정에 영구 저장) |
| 조합 (Compose) | 리소스들을 하나의 패키지로 묶은 재사용 가능한 워크스페이스 템플릿 |

## 대상 플랫폼

- Windows
- macOS

## 기술 스택

- Electron (데스크톱 앱)
- React + TypeScript (GUI)
- Node.js child_process (git 명령 실행)

---

## 기능 요구사항

### 1. 앱 실행 방식

#### 1-1. 기본 실행

- 앱을 직접 실행하여 GUI에서 지정 디렉토리를 선택
- 폴더를 앱 아이콘에 드래그 앤 드롭하여 해당 폴더를 지정 디렉토리로 실행

#### 1-2. CLI 인자 실행

- 커맨드라인에서 폴더 경로를 인자로 전달하여 실행: `workspace-magic <폴더 경로>`
- OS 컨텍스트 메뉴 연동 등 외부 연동 시 이 방식 활용 가능 (컨텍스트 메뉴 등록은 앱이 직접 하지 않음)

### 2. 리소스 레지스트리

앱 내에서 관리되는 리소스 유형:

| 리소스 유형 | Claude Code 경로 | 설명 |
|-------------|------------------|------|
| 소스 레포 | 로컬 git 저장소 경로 | worktree 생성 대상 |
| 스킬 (Skill) | `.claude/.skills/{name}/SKILL.md` + 하위 파일들 | Claude Code 스킬 정의 |
| 에이전트 (Agent) | `.claude/agents/{name}.md` | 커스텀 에이전트 정의 |
| 커맨드 (Command) | `.claude/commands/{name}.md` | 슬래시 커맨드 정의 |
| MCP 설정 | `.mcp.json` | MCP 서버 설정 |

#### 2-1. 리소스 등록 방식

**방식 A: 텍스트 입력으로 생성**
1. 리소스 유형 선택 (스킬 / 에이전트 / 커맨드 / MCP)
2. GUI 에디터에서 내용 작성
   - 스킬: SKILL.md frontmatter + 본문 작성, 하위 파일(references/, examples/ 등) 추가 가능
   - 에이전트: frontmatter + 시스템 프롬프트 작성
   - 커맨드: 커맨드 내용 작성
   - MCP: JSON 에디터로 MCP 서버 설정 작성
3. 앱 데이터에 저장

**방식 B: 기존 파일 등록**
1. 파일 탐색기로 로컬 파일/디렉토리 선택
2. 해당 파일 내용을 앱 데이터로 복사하여 등록
   - 스킬: 디렉토리 단위 등록 (SKILL.md + 하위 파일들)
   - 에이전트/커맨드: 단일 .md 파일 등록
   - MCP: .mcp.json 파일 등록
3. 유효성 검증 후 등록 완료

**방식 C: 소스 레포 등록**
1. 파일 탐색기 다이얼로그로 로컬 git 저장소 경로를 탐색하여 등록
2. 유효성 검증: `git rev-parse --is-inside-work-tree`
3. git 저장소가 아닌 항목은 경고 표시 후 자동 삭제

#### 2-2. 리소스 CRUD

- **생성 (Create)**: 2-1의 방식 A, B, 또는 C
- **조회 (Read)**: 등록된 리소스 목록 표시, 개별 리소스 상세 내용 조회
- **편집 (Update)**: GUI 에디터에서 등록된 리소스 내용 직접 수정
- **삭제 (Delete)**: 레지스트리에서 리소스 제거 (확인 다이얼로그)

#### 2-3. 소스 레포 유효성 검증

- 앱 시작 시 및 등록 시 해당 경로가 유효한 git 저장소인지 검증
- git 저장소가 아닌 항목은 경고 표시 후 자동 삭제

### 3. 조합(Compose) 관리

조합은 다음 요소를 하나의 패키지로 묶음:

```
compose-a (조합)
├── 워크트리 레포 목록
│   ├── repo1 (+ 베이스 브랜치 설정)
│   └── repo2 (+ 베이스 브랜치 설정)
├── 스킬 목록
│   ├── skill-x
│   └── skill-y
├── 에이전트 목록
│   └── agent-a
├── 커맨드 목록
│   └── command-1
└── MCP 설정
    └── mcp-config
```

#### 3-1. 조합 생성/편집

1. 조합 이름 입력
2. 레지스트리에서 포함할 리소스를 체크박스로 선택
   - 소스 레포: 선택 시 베이스 브랜치 지정
   - 스킬/에이전트/커맨드/MCP: 선택만으로 포함
3. 저장

#### 3-2. 조합 CRUD

- 생성: 새 조합 생성
- 조회: 조합 목록 및 상세 (포함된 리소스 표시)
- 편집: 포함 리소스 변경, 이름 변경
- 삭제: 조합 삭제 (확인 다이얼로그)
- 동일 이름의 조합 생성 불가

### 4. GUI

#### 4-1. 메인 화면 레이아웃

- **상단**: 지정 디렉토리 경로 표시
  - 컨텍스트 메뉴에서 실행 시: 전달받은 경로를 자동 세팅
  - 앱을 직접 실행한 경우: 파일 탐색기로 지정 디렉토리를 선택
- **중앙**: 조합 선택 화면 (등록된 조합 목록에서 선택)
- **하단**: 실행 버튼 및 상태 표시

#### 4-2. 리소스 관리 화면

스킬/에이전트/커맨드/MCP/소스 레포의 CRUD를 수행하는 화면

#### 4-3. 조합 관리 화면

조합의 CRUD를 수행하는 화면 (리소스 선택 포함)

### 5. 조합 적용 (워크스페이스 세팅)

메인 화면에서 조합을 선택하고 실행하면 다음이 수행됨:

#### Step 1: .claude/ 구조 생성

```
{지정 디렉토리}/
├── .claude/
│   ├── settings.json          ← 스킬 등록 정보 포함
│   ├── .skills/
│   │   ├── {skill-x}/
│   │   │   ├── SKILL.md
│   │   │   └── references/...
│   │   └── {skill-y}/
│   │       └── SKILL.md
│   ├── agents/
│   │   └── {agent-a}.md
│   └── commands/
│       └── {command-1}.md
└── .mcp.json                  ← MCP 설정
```

- `settings.json`에 스킬 경로 자동 등록
- 스킬은 디렉토리 구조 포함 (SKILL.md + references/ + examples/ 등)
- 에이전트, 커맨드는 .md 파일 생성
- MCP 설정은 .mcp.json으로 생성

#### Step 2: Worktree 생성

조합에 포함된 각 레포에 대해:

1. 새 브랜치 이름 입력 (적용 시점에 사용자 입력)
2. `git worktree add {지정 디렉토리}/{레포 이름} -b {새 브랜치} {베이스 브랜치}` 실행
3. 소스 레포 디렉토리에서 명령 실행

#### 적용 결과 예시

```
{지정 디렉토리}/
├── .claude/                   ← Claude Code 설정
│   ├── settings.json
│   ├── .skills/
│   ├── agents/
│   └── commands/
├── .mcp.json                  ← MCP 설정
├── repo1/                     ← git worktree
└── repo2/                     ← git worktree
```

#### 유연한 구성

- 조합에 레포 없이 .claude/ 설정만 있는 경우: .claude/ 구조만 생성 (유효)
- 조합에 .claude/ 설정 없이 레포만 있는 경우: worktree만 생성 (유효)

### 6. 중복/충돌 처리

| 상황 | 처리 |
|------|------|
| 지정 디렉토리에 동일 이름 디렉토리 존재 (worktree) | 스킵 + 알림 |
| 지정 디렉토리에 .claude/ 이미 존재 | 사용자에게 덮어쓰기/병합/취소 선택 |
| 지정 디렉토리에 .mcp.json 이미 존재 | 사용자에게 덮어쓰기/병합/취소 선택 |

### 7. 진행 상태 표시

| 단계 | 상태 |
|------|------|
| .claude/ 구조 생성 | 대기 / 진행중 / 완료 / 에러 |
| 각 레포 worktree 생성 | 대기 / 진행중 / 완료 / 스킵 / 에러 |

- git 명령 에러 발생 시 에러 메시지 표시

### 8. 데이터 저장

- **저장 위치**: `electron app.getPath('userData')` 하위 JSON 파일
- **저장 내용**:
  - 리소스 레지스트리 (소스 레포 경로, 스킬 데이터, 에이전트 데이터, 커맨드 데이터, MCP 설정)
  - 조합 목록 (각 조합의 리소스 참조)

### 9. 설치 및 배포

**원칙: 시스템을 건드리지 않는다.** OS 레지스트리, 시스템 디렉토리 등 시스템 수준의 변경을 하지 않는다.

#### 9-1. 포터블 실행 (권장)

- **Windows**: 단일 `.exe` 파일 또는 압축 해제 후 바로 실행 가능한 포터블 패키지
- **macOS**: `.app` 번들을 직접 실행 (Applications 폴더에 복사하지 않아도 동작)
- 앱 데이터는 실행 파일과 동일 디렉토리 또는 `electron app.getPath('userData')` 하위에 저장

#### 9-2. 인스톨러 (포터블이 불가능한 경우에 한해)

- 사용자가 설치 경로를 직접 지정
- 설치 시 시스템 레지스트리, 시스템 디렉토리 등 OS 수준의 변경 금지
- **완전한 제거 보장**: 언인스톨 시 앱이 생성한 모든 파일/디렉토리를 깨끗하게 삭제
- 언인스톨 후 시스템에 앱의 흔적이 남지 않아야 함

---

## 비기능 요구사항

- **비동기 실행**: git 명령은 비동기로 실행, UI 블로킹 없어야 함
- **성능**: 조합 적용 시 .claude/ 구조 생성은 1초 이내. 등록된 리소스가 많아도 목록 스크롤이 매끄러워야 함
- **데이터 무결성**: 앱 데이터는 JSON 파일로 안전하게 저장
- **유효성**: 소스 레포 등록/적용 시 유효한 git 저장소인지 검증
- **Claude Code 호환**: 생성되는 .claude/ 구조와 .mcp.json은 Claude Code 공식 경로 체계를 정확히 따름
- **git 의존성**: git이 시스템에 설치되어 있어야 함 (미설치 시 안내 메시지 표시)
- **시스템 안전성**: OS 레지스트리, 시스템 디렉토리 등 시스템 수준의 리소스를 변경하지 않음. 앱의 영향 범위는 앱 데이터 디렉토리와 사용자가 지정한 디렉토리로 한정

---

## 엣지 케이스 & 예외 처리

| 상황 | 처리 방식 |
|------|-----------|
| 조합에 포함된 소스 레포가 삭제/이동됨 | 적용 시 해당 레포 스킵 + 경고 |
| 조합에 포함된 리소스가 삭제됨 | 조합 조회 시 누락 표시 + 경고 |
| .claude/ 구조 생성 중 권한 오류 | 에러 메시지 표시 + 중단 |
| 동일 이름의 조합 생성 시도 | 중복 불가, 에러 메시지 |

---

## 향후 고려 사항 (Scope 외)

- 생성된 worktree 관리 (삭제, 목록 조회)
- 조합 공유/내보내기/가져오기
- CLI 모드 지원
- 원격 저장소에서 클론
- CLAUDE.md 파일 조합 포함

---

## 열린 질문

- [ ] 조합에 포함된 MCP 설정이 여러 개일 때 병합 전략은?
- [ ] 스킬 하위 파일(references/, examples/)의 GUI 편집 UX는 어떻게 구성할 것인가?
- [ ] CLAUDE.md 파일도 조합에 포함할 필요가 있는가?

---

## 변경 이력

| 날짜 | 변경 내용 | 출처 | 작성자 |
|------|-----------|------|--------|
| 2026-02-27 | 기본 워크트리 세팅 기능 | PRD-001 | Claude & godaehyeon |
| 2026-02-27 | Compose 조합 시스템 추가, 기존 워크트리 기능을 조합 기반으로 대체 | PRD-002 | Claude & godaehyeon |
| 2026-02-27 | 시스템 안전성: OS 레지스트리/시스템 디렉토리 조작 금지, 포터블 실행 우선, 컨텍스트 메뉴 자동등록 제거 | 피드백 | Claude & godaehyeon |
