# 테스트 설계서 보완 및 개정 - Workspace Magic

> 에이전트: test-design
> 일시: 2026-02-27 23:00
> 상위 문서: prd/PRD-CONSOLIDATED.md, docs/design.md

## 수행 내용

기존 테스트 설계서(0001에서 작성)를 PRD와 설계서에 다시 대조 분석하여, 누락된 테스트 영역을 보완하고 테스트 케이스를 확충하였다.

### 보완 사항

1. **Preload API 단위 테스트 추가 (3.12 섹션)**: 기존 문서에서 누락되었던 Preload contextBridge API의 IPC 채널 매핑 검증 테스트 9개 추가 (UT-PRE-001~009)
2. **StorageService 경계값 테스트 강화**: 대량 데이터 저장/로드(UT-STO-009), 동시 저장 요청 정합성(UT-STO-010), 백업 복원 성공/실패 분리(UT-STO-003, UT-STO-004)
3. **GitService 명령 인자/보안 검증 추가**: 정확한 execFile 인자 전달 검증(UT-GIT-007), shell injection 방지 확인(UT-GIT-013)
4. **ResourceService 추가 케이스**: 소스 레포 이름 자동 설정(UT-RES-006), 스킬 하위 파일 포함 생성(UT-RES-011), 존재하지 않는 리소스 수정/삭제(UT-RES-029, UT-RES-030)
5. **ComposeService 추가 케이스**: 자기 자신 이름으로 수정 허용(UT-CMP-005), 존재하지 않는 조합 조회/삭제(UT-CMP-016, UT-CMP-017)
6. **WorkspaceService 추가 케이스**: 존재하지 않는 조합 적용(UT-WRK-016), 빈 지정 디렉토리 경로(UT-WRK-017)
7. **ClaudeStructureBuilder settings.json 경로 형식 검증 강화**: `.skills/{name}` 형식 검증(UT-CSB-006), 다수 스킬 동시 생성(UT-CSB-010), 에이전트/커맨드만 있는 경우(UT-CSB-011)
8. **McpConfigBuilder 추가 케이스**: JSON 유효성(UT-MCP-004), mcpServers 키 충돌(UT-MCP-005)
9. **WorktreeCreator 소스 레포 사전 검증 추가**: UT-WTC-005
10. **ConflictResolver 경계값 추가**: 존재하지 않는 디렉토리(UT-CFR-006)
11. **Validators 추가 케이스**: 커맨드 빈 content(UT-VAL-006), 공백만 이름(UT-VAL-010), 조합 이름 유효성(UT-VAL-011, UT-VAL-012)
12. **Renderer Store 추가 케이스**: useAppStore CLI 인자 없는 경우(UT-AST-004), setTargetDir(UT-AST-005), 리소스 수정 후 갱신(UT-RST-004), 타입 필터링(UT-RST-006), 조합 생성 실패(UT-CST-004), 적용 시작/완료 상태(UT-WST-001, UT-WST-004)
13. **통합 테스트 3건 추가**: settings.json-구조 일관성(IT-015), 에러 전파 경로(IT-016), 전체 흐름(IT-017)
14. **E2E 테스트 2건 추가**: 페이지 간 네비게이션(E2E-016), MCP JSON 편집(E2E-017)
15. **PRD 매핑 검증표 전면 갱신**: 추가된 테스트 케이스를 모두 매핑

### 테스트 케이스 수량 변화

| 영역 | 이전 | 이후 | 증감 |
|------|------|------|------|
| 단위 테스트 | 98개 | 128개 | +30 |
| 통합 테스트 | 14개 | 17개 | +3 |
| E2E 테스트 | 15개 | 17개 | +2 |
| **합계** | **127개** | **162개** | **+35** |

## 산출물

- `docs/test-design.md` - Workspace Magic 종합 테스트 설계서 (개정판)

## 주요 결정사항

1. **Preload 계층 테스트 추가**: 설계서(Section 4.9)에 Preload 모듈이 명시되어 있으므로, IPC 채널 매핑의 정확성을 검증하는 단위 테스트를 추가. 커버리지 목표 80%
2. **settings.json 경로 형식 검증 분리**: Claude Code 호환성(NFR-호환)의 핵심인 `.skills/{name}` 경로 형식을 별도 테스트 케이스로 분리하여 명시적 검증
3. **shell injection 방지 검증**: GitService가 execFile(exec 아님)을 사용하는지 검증하는 테스트를 추가하여 NFR-안전 커버리지 향상
4. **통합 테스트에 전체 흐름 테스트 추가**: 리소스 생성 -> 조합 생성 -> 워크스페이스 적용까지의 전체 데이터 흐름을 하나의 통합 테스트로 검증(IT-017)

## 이슈 & 참고

1. 기존 0001에서 기록한 이슈(MCP 병합 전략 미확정, E2E-012 환경, E2E-015 드래그앤드롭 제약, 성능 테스트)는 여전히 유효
2. **McpConfigBuilder 복수 MCP 병합 시 키 충돌 정책**(UT-MCP-005)은 PRD 열린 질문이 해결되면 기대 결과를 확정해야 함
3. **Renderer 컴포넌트 단위 테스트는 미포함**: 설계서에서 Renderer 컴포넌트(ResourceEditor, ComposeBuilder 등)의 렌더링 검증은 E2E로 커버하는 전략 유지. 향후 컴포넌트 복잡도가 높아지면 React Testing Library 도입 고려
